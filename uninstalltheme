#!/usr/bin/env bash
set -e

# ================================
#   Pterodactyl Theme Uninstaller
# ================================

clear
echo -e "\e[1;31mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\e[0m"
echo -e "   ğŸ—‘ï¸  PTERODACTYL THEME UNINSTALLER  ğŸ—‘ï¸"
echo -e "\e[1;31mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\e[0m"
echo ""

echo -e "ğŸš€ Starting theme removal process..."

# Go to panel directory
cd /var/www/pterodactyl || { echo -e "âŒ \e[1;31mPanel directory not found!\e[0m"; exit 1; }

# Maintenance mode
echo -e "âš™ï¸  Putting panel into maintenance mode..."
php artisan down

# Download latest original release (to restore default files)
echo -e "â¬‡ï¸  Restoring default panel files..."
curl -L https://github.com/pterodactyl/panel/releases/latest/download/panel.tar.gz | tar -xzv

# Permissions
echo -e "ğŸ”‘ Fixing file permissions..."
chmod -R 755 storage/* bootstrap/cache

# Composer install
echo -e "ğŸ“¦ Installing clean PHP dependencies..."
composer install --no-dev --optimize-autoloader

# Clear caches
echo -e "ğŸ§¹ Clearing Laravel caches..."
php artisan view:clear
php artisan config:clear

# Migrations (safe, wonâ€™t touch data)
echo -e "ğŸ“‚ Running database migrations..."
php artisan migrate --seed --force

# Ownership
echo -e "ğŸ‘¤ Resetting ownership to www-data..."
chown -R www-data:www-data /var/www/pterodactyl/*

# Restart queue workers
echo -e "â™»ï¸ Restarting queue workers..."
php artisan queue:restart

# Back online
echo -e "âœ… Bringing panel back online..."
php artisan up

# Done
echo ""
echo -e "\e[1;32mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\e[0m"
echo -e " ğŸ‰ Theme successfully uninstalled! Panel reset to default ğŸš€"
echo -e "\e[1;32mâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\e[0m"
